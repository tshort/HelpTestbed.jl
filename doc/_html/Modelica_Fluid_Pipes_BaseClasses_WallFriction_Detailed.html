<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</title>
</head>
<body>
<div id="header">
<h1 class="title">Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</h1>
</div>
<h1 id="modelica.fluid.pipes.baseclasses.wallfriction.detailed"><a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction">Modelica.Fluid.Pipes.BaseClasses.WallFriction</a>.Detailed</h1>
<p><strong>Pipe wall friction in the whole regime (detailed characteristic)</strong></p>
<h2 id="information">Information</h2>
<p>::</p>
<p>This component defines the complete regime of wall friction. The details are described in the <a href="Modelica_Fluid_UsersGuide_ComponentDefinition.html#Modelica.Fluid.UsersGuide.ComponentDefinition.WallFriction">UsersGuide</a>. The functional relationship of the friction loss factor Î» is displayed in the next figure. Function massFlowRate_dp() defines the &quot;red curve&quot; (&quot;Swamee and Jain&quot;), where as function pressureLoss_m_flow() defines the &quot;blue curve&quot; (&quot;Colebrook-White&quot;). The two functions are inverses from each other and give slightly different results in the transition region between Re = 1500 .. 4000, in order to get explicit equations without solving a non-linear equation.</p>
<p>Additionally to wall friction, this component properly implements static head. With respect to the latter, two cases can be distinguished. In the case shown next, the change of elevation with the path from a to b has the opposite sign of the change of density.</p>
<p>In the case illustrated second, the change of elevation with the path from a to b has the same sign of the change of density.</p>
<p>::</p>
<p>Extends from <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_PartialWallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.PartialWallFriction">PartialWallFriction</a> (Partial wall friction characteristic (base package of all wall friction characteristics)).</p>
<h2 id="package-content">Package Content</h2>
<p>Name</p>
<p>Description</p>
<p><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpS.png" alt="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dp" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dp">massFlowRate_dp</a></p>
<p>Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction</p>
<p><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpS.png" alt="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.pressureLoss_m_flow" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.pressureLoss_m_flow">pressureLoss_m_flow</a></p>
<p>Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction</p>
<p><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpS.png" alt="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dp_staticHead" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dp_staticHead">massFlowRate_dp_staticHead</a></p>
<p>Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction and static head</p>
<p><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpS.png" alt="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.pressureLoss_m_flow_staticHead" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.pressureLoss_m_flow_staticHead">pressureLoss_m_flow_staticHead</a></p>
<p>Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction and static head</p>
<p><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.InternalS.png" alt="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.Internal" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed_Internal.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.Internal">Internal</a></p>
<p>Functions to calculate mass flow rate from friction pressure drop and vice versa</p>
<p>Inherited</p>
<p>use_mu=true</p>
<p>= true, if mu_a/mu_b are used in function, otherwise value is not used</p>
<p>use_roughness=true</p>
<p>= true, if roughness is used in function, otherwise value is not used</p>
<p>use_dp_small=true</p>
<p>= true, if dp_small is used in function, otherwise value is not used</p>
<p>use_m_flow_small=true</p>
<p>= true, if m_flow_small is used in function, otherwise value is not used</p>
<p>dp_is_zero=false</p>
<p>= true, if no wall friction is present, i.e., dp = 0 (function massFlowRate_dp() cannot be used)</p>
<hr />
<h1 id="image5-modelica.fluid.pipes.baseclasses.wallfriction.detailed.massflowrate_dp"><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpI.png" alt="image5" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed">Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</a>.massFlowRate_dp</h1>
<p><strong>Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction</strong></p>
<h2 id="information-1">Information</h2>
<p>::</p>
<p>::</p>
<p>Extends from <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_PartialWallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.PartialWallFriction.massFlowRate_dp"></a> (Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction).</p>
<h2 id="inputs">Inputs</h2>
<table>
<col width="37%" />
<col width="6%" />
<col width="5%" />
<col width="50%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Pressure">Pressure</a></td>
<td align="left">dp</td>
<td align="left">
</td>
<td align="left">Pressure loss (dp = port_a.p - port_b.p) [Pa]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_a</td>
<td align="left">
</td>
<td align="left">Density at port_a [kg/m3]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_b</td>
<td align="left">
</td>
<td align="left">Density at port_b [kg/m3]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_a</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_a (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_b</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_b (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">length</td>
<td align="left">
</td>
<td align="left">Length of pipe [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Diameter">Diameter</a></td>
<td align="left">diameter</td>
<td align="left">
</td>
<td align="left">Inner (hydraulic) diameter of pipe [m]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">roughness</td>
<td align="left">2.5e-5</td>
<td align="left">Absolute roughness of pipe, with a default for a smooth steel pipe (dummy if use_roughness = false) [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.AbsolutePressure">AbsolutePressure</a></td>
<td align="left">dp_small</td>
<td align="left">1</td>
<td align="left">Turbulent flow if |dp| &gt;= dp_small (dummy if use_dp_small = false) [Pa]</td>
</tr>
</tbody>
</table>
<h2 id="outputs">Outputs</h2>
<table>
<col width="54%" />
<col width="8%" />
<col width="36%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow</td>
<td align="left">Mass flow rate from port_a to port_b [kg/s]</td>
</tr>
</tbody>
</table>
<h2 id="modelica-definition">Modelica definition</h2>
<pre><code>redeclare function extends massFlowRate_dp 
  &quot;Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction&quot;
  import Modelica.Math;
protected 
  constant Real pi = Modelica.Constants.pi;
  Real Delta = roughness/diameter &quot;Relative roughness&quot;;
  SI.ReynoldsNumber Re1 = (745*Math.exp(if Delta &lt;= 0.0065 then 1 else 0.0065/Delta))^0.97 
    &quot;Re leaving laminar curve&quot;;
  SI.ReynoldsNumber Re2 = 4000 &quot;Re entering turbulent curve&quot;;
  SI.DynamicViscosity mu &quot;Upstream viscosity&quot;;
  SI.Density rho &quot;Upstream density&quot;;
  SI.ReynoldsNumber Re &quot;Reynolds number&quot;;
  Real lambda2 &quot;Modified friction coefficient (= lambda*Re^2)&quot;;

  function interpolateInRegion2
     input Real Re_turbulent;
     input SI.ReynoldsNumber Re1;
     input SI.ReynoldsNumber Re2;
     input Real Delta;
     input Real lambda2;
     output SI.ReynoldsNumber Re;
    // point lg(lambda2(Re1)) with derivative at lg(Re1)
  protected 
    Real x1=Math.log10(64*Re1);
    Real y1=Math.log10(Re1);
    Real yd1=1;

    // Point lg(lambda2(Re2)) with derivative at lg(Re2)
    Real aux1=(0.5/Math.log(10))*5.74*0.9;
    Real aux2=Delta/3.7 + 5.74/Re2^0.9;
    Real aux3=Math.log10(aux2);
    Real L2=0.25*(Re2/aux3)^2;
    Real aux4=2.51/sqrt(L2) + 0.27*Delta;
    Real aux5=-2*sqrt(L2)*Math.log10(aux4);
    Real x2=Math.log10(L2);
    Real y2=Math.log10(aux5);
    Real yd2=0.5 + (2.51/Math.log(10))/(aux5*aux4);

    // Constants: Cubic polynomial between lg(Re1) and lg(Re2)
    Real diff_x=x2 - x1;
    Real m=(y2 - y1)/diff_x;
    Real c2=(3*m - 2*yd1 - yd2)/diff_x;
    Real c3=(yd1 + yd2 - 2*m)/(diff_x*diff_x);
    Real lambda2_1=64*Re1;
    Real dx;
  algorithm 
     dx := Math.log10(lambda2/lambda2_1);
     Re := Re1*(lambda2/lambda2_1)^(1 + dx*(c2 + dx*c3));
  end interpolateInRegion2;

algorithm 
  // Determine upstream density, upstream viscosity, and lambda2
  rho     := if dp &gt;= 0 then rho_a else rho_b;
  mu      := if dp &gt;= 0 then mu_a else mu_b;
  lambda2 := abs(dp)*2*diameter^3*rho/(length*mu*mu);

  // Determine Re under the assumption of laminar flow
  Re := lambda2/64;

  // Modify Re, if turbulent flow
  if Re &gt; Re1 then
     Re :=-2*sqrt(lambda2)*Math.log10(2.51/sqrt(lambda2) + 0.27*Delta);
     if Re &lt; Re2 then
        Re := interpolateInRegion2(Re, Re1, Re2, Delta, lambda2);
     end if;
  end if;

  // Determine mass flow rate
  m_flow := (pi*diameter/4)*mu*(if dp &gt;= 0 then Re else -Re);
end massFlowRate_dp;</code></pre>
<hr />
<h1 id="image6-modelica.fluid.pipes.baseclasses.wallfriction.detailed.pressureloss_m_flow"><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpI.png" alt="image6" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed">Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</a>.pressureLoss_m_flow</h1>
<p><strong>Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction</strong></p>
<h2 id="information-2">Information</h2>
<p>::</p>
<p>::</p>
<p>Extends from <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_PartialWallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.PartialWallFriction.pressureLoss_m_flow"></a> (Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction).</p>
<h2 id="inputs-1">Inputs</h2>
<table>
<col width="36%" />
<col width="8%" />
<col width="5%" />
<col width="49%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow</td>
<td align="left">
</td>
<td align="left">Mass flow rate from port_a to port_b [kg/s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_a</td>
<td align="left">
</td>
<td align="left">Density at port_a [kg/m3]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_b</td>
<td align="left">
</td>
<td align="left">Density at port_b [kg/m3]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_a</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_a (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_b</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_b (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">length</td>
<td align="left">
</td>
<td align="left">Length of pipe [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Diameter">Diameter</a></td>
<td align="left">diameter</td>
<td align="left">
</td>
<td align="left">Inner (hydraulic) diameter of pipe [m]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">roughness</td>
<td align="left">2.5e-5</td>
<td align="left">Absolute roughness of pipe, with a default for a smooth steel pipe (dummy if use_roughness = false) [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow_small</td>
<td align="left">0.01</td>
<td align="left">Turbulent flow if |m_flow| &gt;= m_flow_small (dummy if use_m_flow_small = false) [kg/s]</td>
</tr>
</tbody>
</table>
<h2 id="outputs-1">Outputs</h2>
<table>
<col width="51%" />
<col width="7%" />
<col width="40%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Pressure">Pressure</a></td>
<td align="left">dp</td>
<td align="left">Pressure loss (dp = port_a.p - port_b.p) [Pa]</td>
</tr>
</tbody>
</table>
<h2 id="modelica-definition-1">Modelica definition</h2>
<pre><code>redeclare function extends pressureLoss_m_flow 
  &quot;Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction&quot;
  import Modelica.Math;
protected 
  constant Real pi = Modelica.Constants.pi;
  Real Delta = roughness/diameter &quot;Relative roughness&quot;;
  SI.ReynoldsNumber Re1 = 745*Math.exp(if Delta &lt;= 0.0065 then 1 else 0.0065/Delta) 
    &quot;Re leaving laminar curve&quot;;
  SI.ReynoldsNumber Re2 = 4000 &quot;Re entering turbulent curve&quot;;
  SI.DynamicViscosity mu &quot;Upstream viscosity&quot;;
  SI.Density rho &quot;Upstream density&quot;;
  SI.ReynoldsNumber Re &quot;Reynolds number&quot;;
  Real lambda2 &quot;Modified friction coefficient (= lambda*Re^2)&quot;;

  function interpolateInRegion2
     input SI.ReynoldsNumber Re;
     input SI.ReynoldsNumber Re1;
     input SI.ReynoldsNumber Re2;
     input Real Delta;
     output Real lambda2;
    // point lg(lambda2(Re1)) with derivative at lg(Re1)
  protected 
    Real x1 = Math.log10(Re1);
    Real y1 = Math.log10(64*Re1);
    Real yd1=1;

    // Point lg(lambda2(Re2)) with derivative at lg(Re2)
    Real aux1=(0.5/Math.log(10))*5.74*0.9;
    Real aux2=Delta/3.7 + 5.74/Re2^0.9;
    Real aux3=Math.log10(aux2);
    Real L2=0.25*(Re2/aux3)^2;
    Real aux4=2.51/sqrt(L2) + 0.27*Delta;
    Real aux5=-2*sqrt(L2)*Math.log10(aux4);
    Real x2 =  Math.log10(Re2);
    Real y2 =  Math.log10(L2);
    Real yd2 = 2 + 4*aux1/(aux2*aux3*(Re2)^0.9);

    // Constants: Cubic polynomial between lg(Re1) and lg(Re2)
    Real diff_x=x2 - x1;
    Real m=(y2 - y1)/diff_x;
    Real c2=(3*m - 2*yd1 - yd2)/diff_x;
    Real c3=(yd1 + yd2 - 2*m)/(diff_x*diff_x);
    Real dx;
  algorithm 
     dx := Math.log10(Re/Re1);
     lambda2 := 64*Re1*(Re/Re1)^(1 + dx*(c2 + dx*c3));
  end interpolateInRegion2;
algorithm 
  // Determine upstream density and upstream viscosity
  rho     :=if m_flow &gt;= 0 then rho_a else rho_b;
  mu      :=if m_flow &gt;= 0 then mu_a else mu_b;

  // Determine Re, lambda2 and pressure drop
  Re :=(4/pi)*abs(m_flow)/(diameter*mu);
  lambda2 := if Re &lt;= Re1 then 64*Re else 
            (if Re &gt;= Re2 then 0.25*(Re/Math.log10(Delta/3.7 + 5.74/Re^0.9))^2 else 
             interpolateInRegion2(Re, Re1, Re2, Delta));
  dp :=length*mu*mu/(2*rho*diameter*diameter*diameter)*
       (if m_flow &gt;= 0 then lambda2 else -lambda2);
end pressureLoss_m_flow;</code></pre>
<hr />
<h1 id="image7-modelica.fluid.pipes.baseclasses.wallfriction.detailed.massflowrate_dp_statichead"><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpI.png" alt="image7" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed">Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</a>.massFlowRate_dp_staticHead</h1>
<p><strong>Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction and static head</strong></p>
<h2 id="information-3">Information</h2>
<p>Extends from <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_PartialWallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.PartialWallFriction.massFlowRate_dp_staticHead"></a> (Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction and static head).</p>
<h2 id="inputs-2">Inputs</h2>
<table>
<col width="35%" />
<col width="10%" />
<col width="5%" />
<col width="47%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Pressure">Pressure</a></td>
<td align="left">dp</td>
<td align="left">
</td>
<td align="left">Pressure loss (dp = port_a.p - port_b.p) [Pa]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_a</td>
<td align="left">
</td>
<td align="left">Density at port_a [kg/m3]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_b</td>
<td align="left">
</td>
<td align="left">Density at port_b [kg/m3]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_a</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_a (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_b</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_b (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">length</td>
<td align="left">
</td>
<td align="left">Length of pipe [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Diameter">Diameter</a></td>
<td align="left">diameter</td>
<td align="left">
</td>
<td align="left">Inner (hydraulic) diameter of pipe [m]</td>
</tr>
<tr class="even">
<td align="left">Real</td>
<td align="left">g_times_height_ab</td>
<td align="left">
</td>
<td align="left">Gravity times (Height(port_b) - Height(port_a))</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">roughness</td>
<td align="left">2.5e-5</td>
<td align="left">Absolute roughness of pipe, with a default for a smooth steel pipe (dummy if use_roughness = false) [m]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.AbsolutePressure">AbsolutePressure</a></td>
<td align="left">dp_small</td>
<td align="left">1</td>
<td align="left">Turbulent flow if |dp| &gt;= dp_small (dummy if use_dp_small = false) [Pa]</td>
</tr>
</tbody>
</table>
<h2 id="outputs-2">Outputs</h2>
<table>
<col width="54%" />
<col width="8%" />
<col width="36%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow</td>
<td align="left">Mass flow rate from port_a to port_b [kg/s]</td>
</tr>
</tbody>
</table>
<h2 id="modelica-definition-2">Modelica definition</h2>
<pre><code>redeclare function extends massFlowRate_dp_staticHead 
  &quot;Return mass flow rate m_flow as function of pressure loss dp, i.e., m_flow = f(dp), due to wall friction and static head&quot;

protected 
  Real Delta = roughness/diameter &quot;Relative roughness&quot;;
  SI.ReynoldsNumber Re &quot;Reynolds number&quot;;
  SI.ReynoldsNumber Re1 = (745*exp(if Delta &lt;= 0.0065 then 1 else 0.0065/Delta))^0.97 
    &quot;Boundary between laminar regime and transition&quot;;
  constant SI.ReynoldsNumber Re2 = 4000 
    &quot;Boundary between transition and turbulent regime&quot;;
  SI.Pressure dp_a 
    &quot;Upper end of regularization domain of the m_flow(dp) relation&quot;;
  SI.Pressure dp_b 
    &quot;Lower end of regularization domain of the m_flow(dp) relation&quot;;
  SI.MassFlowRate m_flow_a &quot;Value at upper end of regularization domain&quot;;
  SI.MassFlowRate m_flow_b &quot;Value at lower end of regularization domain&quot;;

  SI.MassFlowRate dm_flow_ddp_fric_a 
    &quot;Derivative at upper end of regularization domain&quot;;
  SI.MassFlowRate dm_flow_ddp_fric_b 
    &quot;Derivative at lower end of regularization domain&quot;;

  SI.Pressure dp_grav_a = g_times_height_ab*rho_a 
    &quot;Static head if mass flows in design direction (a to b)&quot;;
  SI.Pressure dp_grav_b = g_times_height_ab*rho_b 
    &quot;Static head if mass flows against design direction (b to a)&quot;;

  // Properly define zero mass flow conditions
  SI.MassFlowRate m_flow_zero = 0;
  SI.Pressure dp_zero = (dp_grav_a + dp_grav_b)/2;
  Real dm_flow_ddp_fric_zero;

algorithm 
  dp_a := max(dp_grav_a, dp_grav_b)+dp_small;
  dp_b := min(dp_grav_a, dp_grav_b)-dp_small;

  if dp&gt;=dp_a then
    // Positive flow outside regularization
    m_flow := Internal.m_flow_of_dp_fric(dp-dp_grav_a, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
  elseif dp&lt;=dp_b then
    // Negative flow outside regularization
    m_flow := Internal.m_flow_of_dp_fric(dp-dp_grav_b, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
  else
    // Regularization parameters
    (m_flow_a, dm_flow_ddp_fric_a) := Internal.m_flow_of_dp_fric(dp_a-dp_grav_a, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
    (m_flow_b, dm_flow_ddp_fric_b) := Internal.m_flow_of_dp_fric(dp_b-dp_grav_b, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
    // Include a properly defined zero mass flow point
    // Obtain a suitable slope from the linear section slope c (value of m_flow is overwritten later)
    (m_flow, dm_flow_ddp_fric_zero) := Utilities.regFun3(dp_zero, dp_b, dp_a, m_flow_b, m_flow_a, dm_flow_ddp_fric_b, dm_flow_ddp_fric_a);
    // Do regularization
    if dp&gt;dp_zero then
      m_flow := Utilities.regFun3(dp, dp_zero, dp_a, m_flow_zero, m_flow_a, dm_flow_ddp_fric_zero, dm_flow_ddp_fric_a);
    else
      m_flow := Utilities.regFun3(dp, dp_b, dp_zero, m_flow_b, m_flow_zero, dm_flow_ddp_fric_b, dm_flow_ddp_fric_zero);
    end if;
  end if;
end massFlowRate_dp_staticHead;</code></pre>
<hr />
<h1 id="image8-modelica.fluid.pipes.baseclasses.wallfriction.detailed.pressureloss_m_flow_statichead"><img src="Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed.massFlowRate_dpI.png" alt="image8" /> <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_Detailed.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed">Modelica.Fluid.Pipes.BaseClasses.WallFriction.Detailed</a>.pressureLoss_m_flow_staticHead</h1>
<p><strong>Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction and static head</strong></p>
<h2 id="information-4">Information</h2>
<p>Extends from <a href="Modelica_Fluid_Pipes_BaseClasses_WallFriction_PartialWallFriction.html#Modelica.Fluid.Pipes.BaseClasses.WallFriction.PartialWallFriction.pressureLoss_m_flow_staticHead"></a> (Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction and static head).</p>
<h2 id="inputs-3">Inputs</h2>
<table>
<col width="35%" />
<col width="10%" />
<col width="5%" />
<col width="47%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Default</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow</td>
<td align="left">
</td>
<td align="left">Mass flow rate from port_a to port_b [kg/s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_a</td>
<td align="left">
</td>
<td align="left">Density at port_a [kg/m3]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Density">Density</a></td>
<td align="left">rho_b</td>
<td align="left">
</td>
<td align="left">Density at port_b [kg/m3]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_a</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_a (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.DynamicViscosity">DynamicViscosity</a></td>
<td align="left">mu_b</td>
<td align="left">
</td>
<td align="left">Dynamic viscosity at port_b (dummy if use_mu = false) [Pa.s]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">length</td>
<td align="left">
</td>
<td align="left">Length of pipe [m]</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Diameter">Diameter</a></td>
<td align="left">diameter</td>
<td align="left">
</td>
<td align="left">Inner (hydraulic) diameter of pipe [m]</td>
</tr>
<tr class="even">
<td align="left">Real</td>
<td align="left">g_times_height_ab</td>
<td align="left">
</td>
<td align="left">Gravity times (Height(port_b) - Height(port_a))</td>
</tr>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Length">Length</a></td>
<td align="left">roughness</td>
<td align="left">2.5e-5</td>
<td align="left">Absolute roughness of pipe, with a default for a smooth steel pipe (dummy if use_roughness = false) [m]</td>
</tr>
<tr class="even">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.MassFlowRate">MassFlowRate</a></td>
<td align="left">m_flow_small</td>
<td align="left">0.01</td>
<td align="left">Turbulent flow if |m_flow| &gt;= m_flow_small (dummy if use_m_flow_small = false) [kg/s]</td>
</tr>
</tbody>
</table>
<h2 id="outputs-3">Outputs</h2>
<table>
<col width="51%" />
<col width="7%" />
<col width="40%" />
<thead>
<tr class="header">
<th align="left">Type</th>
<th align="left">Name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><a href="Modelica_SIunits.html#Modelica.SIunits.Pressure">Pressure</a></td>
<td align="left">dp</td>
<td align="left">Pressure loss (dp = port_a.p - port_b.p) [Pa]</td>
</tr>
</tbody>
</table>
<h2 id="modelica-definition-3">Modelica definition</h2>
<pre><code>redeclare function extends pressureLoss_m_flow_staticHead 
  &quot;Return pressure loss dp as function of mass flow rate m_flow, i.e., dp = f(m_flow), due to wall friction and static head&quot;

protected 
  Real Delta = roughness/diameter &quot;Relative roughness&quot;;
  SI.ReynoldsNumber Re1 = 745*exp(if Delta &lt;= 0.0065 then 1 else 0.0065/Delta) 
    &quot;Boundary between laminar regime and transition&quot;;
  constant SI.ReynoldsNumber Re2 = 4000 
    &quot;Boundary between transition and turbulent regime&quot;;

  SI.MassFlowRate m_flow_a 
    &quot;Upper end of regularization domain of the dp(m_flow) relation&quot;;
  SI.MassFlowRate m_flow_b 
    &quot;Lower end of regularization domain of the dp(m_flow) relation&quot;;

  SI.Pressure dp_a &quot;Value at upper end of regularization domain&quot;;
  SI.Pressure dp_b &quot;Value at lower end of regularization domain&quot;;

  SI.Pressure dp_grav_a = g_times_height_ab*rho_a 
    &quot;Static head if mass flows in design direction (a to b)&quot;;
  SI.Pressure dp_grav_b = g_times_height_ab*rho_b 
    &quot;Static head if mass flows against design direction (b to a)&quot;;

  Real ddp_dm_flow_a 
    &quot;Derivative of pressure drop with mass flow rate at m_flow_a&quot;;
  Real ddp_dm_flow_b 
    &quot;Derivative of pressure drop with mass flow rate at m_flow_b&quot;;

  // Properly define zero mass flow conditions
  SI.MassFlowRate m_flow_zero = 0;
  SI.Pressure dp_zero = (dp_grav_a + dp_grav_b)/2;
  Real ddp_dm_flow_zero;

algorithm 
  m_flow_a := if dp_grav_a&lt;dp_grav_b then 
    Internal.m_flow_of_dp_fric(dp_grav_b - dp_grav_a, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta)+m_flow_small else 
    m_flow_small;
  m_flow_b := if dp_grav_a&lt;dp_grav_b then 
    Internal.m_flow_of_dp_fric(dp_grav_a - dp_grav_b, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta)-m_flow_small else 
    -m_flow_small;

  if m_flow&gt;=m_flow_a then
    // Positive flow outside regularization
    dp := Internal.dp_fric_of_m_flow(m_flow, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta) + dp_grav_a;
  elseif m_flow&lt;=m_flow_b then
    // Negative flow outside regularization
    dp := Internal.dp_fric_of_m_flow(m_flow, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta) + dp_grav_b;
  else
    // Regularization parameters
    (dp_a, ddp_dm_flow_a) := Internal.dp_fric_of_m_flow(m_flow_a, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
    dp_a := dp_a + dp_grav_a &quot;Adding dp_grav to dp_fric to get dp&quot;;
    (dp_b, ddp_dm_flow_b) := Internal.dp_fric_of_m_flow(m_flow_b, rho_a, rho_b, mu_a, mu_b, length, diameter, Re1, Re2, Delta);
    dp_b := dp_b + dp_grav_b &quot;Adding dp_grav to dp_fric to get dp&quot;;
    // Include a properly defined zero mass flow point
    // Obtain a suitable slope from the linear section slope c (value of dp is overwritten later)
    (dp, ddp_dm_flow_zero) := Utilities.regFun3(m_flow_zero, m_flow_b, m_flow_a, dp_b, dp_a, ddp_dm_flow_b, ddp_dm_flow_a);
    // Do regularization
    if m_flow&gt;m_flow_zero then
      dp := Utilities.regFun3(m_flow, m_flow_zero, m_flow_a, dp_zero, dp_a, ddp_dm_flow_zero, ddp_dm_flow_a);
    else
      dp := Utilities.regFun3(m_flow, m_flow_b, m_flow_zero, dp_b, dp_zero, ddp_dm_flow_b, ddp_dm_flow_zero);
    end if;
  end if;
end pressureLoss_m_flow_staticHead;</code></pre>
<hr />
<p><a href="http://www.3ds.com/">Automatically generated</a> Fri Nov 12 16:31:15 2010.</p>
</body>
</html>
